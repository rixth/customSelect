(function(a){function g(b,c){var d=this,e,f,g,h;d.options.customRange?(e=d.options.customRangeHelper(c[0],c[1]),g=e[0],f=e[1]):g=f=c,d._setWindowText(f),d.userCustomValue=g,h=a('<option data-custom="true" value="'+g+'">'+f+"</option>"),d.element.find("option[data-custom]").remove(),d.element.append(h.attr("selected",!0)).trigger("change",b),d._trigger("change",b),d.root.find("input:checked").attr("checked",!1)}var b="ui-customSelect-open",c="ui-customRange-disabled",d="customselect",e,f;a.widget("ui.customSelect",{options:{placeholder:"Please select some items",defaultValue:null,customRange:!1,customValue:!1,customValuePlaceholder:"custom value",customRanges:null,windowFormatter:function(a){return a},customRangeHelper:function(a,b){var c,d;a&&b?(c=a+"-"+b,d=a==b?a:a+" to "+b):a&&!b?(c=a+"p",d=a+"+"):!a&&b&&(c="0-"+b,d="0 to "+b);return[c,d]},reverseRangeHelper:function(a){if(a.match(/^\d+-\d+$/))return a.split("-");if(a.match(/^\d+p$/))return[a.match(/^(\d+)p$/)[1],""]}},_create:function(){var g=this,h=g.options,i=h.defaultValue,j=this.element,k,l,m=!1;if(!j.is("select"))throw new TypeError("jquery.customSelect expects a <select> element.");g.userCustomValue=null,g.rootId=j.attr("id")+"_customSelect",l=['<div class="ui-customSelect">','  <div class="ui-customSelect-window"><span></span>','    <div class="ui-customSelect-arrow ui-customSelect-downArrow">&#x25BC;</div>','    <div class="ui-customSelect-arrow ui-customSelect-upArrow">&#x25B2;</div>',"  </div>",'  <div class="ui-customSelect-dropdown"><ul></ul></div>',"</div>"],this.root=k=a(l.join("")).attr("id",g.rootId),j.after(k).hide(),this.window=k.find(".ui-customSelect-window span"),this.list=k.find("ul"),g._createFromSelect(),g._setWindowText(),g.window.parent().click(function(a){g._trigger(m?"blur":"focus",a)}),k.delegate("li>input","change",function(b){g.userCustomValue=null,g._setWindowText(),j.val(g.getVal()).trigger("change"),g._trigger("change",b,{element:this,value:this.value}),a(".ui-customSelect-rangeContainer input, .ui-customSelect-customValue").val(""),a(".ui-customSelect-error").hide(),g.userCustomValue=null}),j.bind(d+"focus",function(){k.hasClass(c)||(m=!0,k.addClass(b),a(document).bind("click.customRange"+g.rootId,function(b){a.contains(k[0],b.target)||g._trigger("blur")}))}).bind(d+"blur",function(){a(document).unbind("click.customRange"+g.rootId),m=!1,k.removeClass(b)}).bind(d+"disabled",function(){k.addClass(c),m&&g._trigger("blur")}).bind(d+"enabled",function(){k.removeClass(c)});if(g.isMultiple&&i){function n(){g.getVal().length||g.list.find("input[value="+i+"]").attr("checked",!0).change()}j.bind(d+"change",n),n()}!g.isMultiple&&(h.customRange||h.customValue)&&(g.setCustomValueError=function(a){k.find(".ui-customSelect-error").show().html(a)},h.customRange?e.call(g,k,this.list,h):h.customValue&&f.call(g,k,this.list,h))},setVal:function(a){var b=this.element.find("option[value="+a+"]"),c;b.length&&!b[0].attributes["data-custom"]?(this.element.val(a),this.reload(),this._setWindowText()):this.options.customRange?(c=this.options.reverseRangeHelper(a),this.root.find(".ui-customSelect-min").val(c[0]),this.root.find(".ui-customSelect-max").val(c[1]),g.call(this,null,c)):this.options.customValue&&(this.root.find(".ui-customSelect-customValue").val(a),g.call(this,null,a))},getVal:function(){if(this.userCustomValue!==null)return this.userCustomValue;var a=this.root.find("li>input:checked").map(function(){return this.value}).toArray();return a.length?a[this.isMultiple?"slice":"pop"]():this.isMultiple?[]:null},friendlyVal:function(){return this.root.find("input:checked+label").map(function(){return this.innerHTML}).toArray()},_setWindowText:function(a){var b;a||(b=this.friendlyVal(),a=b.length?b.join(", "):this.options.placeholder),this.window.html(this.options.windowFormatter(a))},_createFromSelect:function(){var b=this,c=0,d=b.list,e=d.prev()[0]||d.parent();b.isMultiple=b.element.attr("multiple"),d.empty(),this.element.children().each(function(){var e=this,f=b.rootId+"_"+c++,g='<label for="'+f+'">'+e.innerHTML+"</label>",h;b.isMultiple?h=a('<input id="'+f+'" type="checkbox" value="'+e.value+'">'):h=a('<input id="'+f+'" name="'+b.rootId+'_radio" type="radio" value="'+e.value+'">'),d.append(a("<li></li>").append(h).append(" ").append(g)),e.selected&&h.attr("checked",!0)})},reload:function(){this.element.find("option[data-custom]").remove(),this.root.find("input[type='text']").val("").blur(),this.userCustomValue=null,this._createFromSelect()},_setOption:function(a,b){a==="disabled"&&this._trigger((b?"dis":"en")+"abled")},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments),a(document).unbind("click.customRange"+this.rootId),this.root.remove(),this.element.show()}}),f=function(b,c,d){function i(b){var c=h.val();e._trigger("customvaluechange",b,{value:c,widget:e})&&(a(".ui-customSelect-error").hide(),g.call(e,b,c),e._trigger("blur"))}var e=this,f=d.customValue,h;c.before(a(['<div class="ui-customSelect-customValueContainer">','  <input class="ui-customSelect-customValue" type="text" placeholder="'+d.customValuePlaceholder+'" />','  <div style="display: none" class="ui-customSelect-error"></div>',"</div>"].join(""))),h=b.find(".ui-customSelect-customValue");if(typeof f=="string"||typeof f=="number")h.val(f),i();h.bind("keydown",function(a){a.which===13&&i(a)})},e=function(b,c,d){function k(b){var c=h.val(),d=i.val(),e={min:c,max:d,widget:j},f,k;isNaN(c)||isNaN(d)?j.setCustomValueError("Please enter only numbers."):c&&d&&c>d?j.setCustomValueError("Min cannot be bigger than max."):j._trigger("rangechange",b,e)&&(a(".ui-customSelect-error").hide(),g.call(j,b,[c,d]),j._trigger("blur"))}var e,f,h,i,j=this;e=['<div class="ui-customSelect-rangeContainer">','  <input type="text" class="ui-customSelect-min" placeholder="min" /> to &nbsp;<input type="text" class="ui-customSelect-max" placeholder="max" />','  <div style="display: none" class="ui-customSelect-error"></div>',"</div>"],c.after(a(e.join(""))),h=b.find(".ui-customSelect-min"),i=b.find(".ui-customSelect-max"),f=b,d.customRanges&&(h.val(d.customRanges.min),i.val(d.customRanges.max),k()),h.add(i).bind("keydown",function(a){a.which===13&&k(a)})}})(jQuery)